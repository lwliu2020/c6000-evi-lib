<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>C6000-evi-lib: pllc.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">C6000-evi-lib</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('pllc_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">pllc.c</div>  </div>
</div>
<div class="contents">
<a href="pllc_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="code" href="pllc_8h.html" title="Define some macros, registers, and function prototype to handle PLL module.">include/pllc.h</a>&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="code" href="sysconfig_8h.html">include/sysconfig.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="code" href="systemConfigurations_8h.html" title="Extern some variables that is used for configure system. (All module can use these variables)...">include/systemConfigurations.h</a>&gt;</span>
<a name="l00013"></a><a class="code" href="pllc_8c.html#a7becba95a12f7e2c183abd544e4bebb0">00013</a> <a class="code" href="types_8h.html#adf1ef98b7070177c7c709b0b82276a07">Int32</a> <a class="code" href="pllc_8h.html#a7becba95a12f7e2c183abd544e4bebb0" title="This method is used to set up PLL multiplier.">setup_pll</a>(<a class="code" href="types_8h.html#a60cf7b3c038ce37a50796e8eaddf0b5f">Uint32</a> multi)
<a name="l00014"></a>00014 {
<a name="l00015"></a>00015     <span class="keywordtype">int</span> i = 0;
<a name="l00016"></a>00016 
<a name="l00017"></a>00017     <span class="comment">/* DSP at 300MHz, EMIFs at 133MHz */</span>
<a name="l00018"></a>00018     <span class="comment">//unsigned int DIV45_EN = 1;</span>
<a name="l00019"></a>00019     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CLKMODE = 0;
<a name="l00020"></a>00020     <span class="keywordflow">if</span>(multi * <a class="code" href="systemConfigurations_8h.html#a8a358bfec91e68ba4dff9af8ce7e040c">CRYSTAL_FREQ</a> &gt; <a class="code" href="systemConfigurations_8h.html#a82a12c263c316a8f6fde1757302ef63a">MAX_PLL_FREQ</a>){
<a name="l00021"></a>00021         multi=<a class="code" href="systemConfigurations_8h.html#a82a12c263c316a8f6fde1757302ef63a">MAX_PLL_FREQ</a>/<a class="code" href="systemConfigurations_8h.html#a8a358bfec91e68ba4dff9af8ce7e040c">CRYSTAL_FREQ</a>;
<a name="l00022"></a>00022     }
<a name="l00023"></a>00023     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PLLM = multi;
<a name="l00024"></a>00024     <a class="code" href="systemConfigurations_8h.html#a7d69cd7ba1ed8c3937f9bddd3af4e2d1" title="Default bypass mode.">DSPFreq</a>=<a class="code" href="systemConfigurations_8h.html#a8a358bfec91e68ba4dff9af8ce7e040c">CRYSTAL_FREQ</a>*multi/<a class="code" href="systemConfigurations_8h.html#a43b5b35d09b47633d84aa8121c9af2ac">POST_PLL_DIVIDER</a>;
<a name="l00025"></a>00025     <span class="comment">// /** @code // @endcode*/</span>
<a name="l00026"></a>00026     <a class="code" href="systemConfigurations_8h.html#ae0623ddd0c5f7e3694346e465627827e" title="Default bypass mode.">UARTFreq</a>=(<a class="code" href="systemConfigurations_8h.html#a8a358bfec91e68ba4dff9af8ce7e040c">CRYSTAL_FREQ</a>*multi)/(<a class="code" href="systemConfigurations_8h.html#a43b5b35d09b47633d84aa8121c9af2ac">POST_PLL_DIVIDER</a>*2); 
<a name="l00027"></a>00027     <a class="code" href="systemConfigurations_8h.html#a112be3f36c1235d3ca1364b32208555d" title="Always bypass mode.">TimerFreq</a>=(<a class="code" href="systemConfigurations_8h.html#a8a358bfec91e68ba4dff9af8ce7e040c">CRYSTAL_FREQ</a>); 
<a name="l00029"></a>00029     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> POSTDIV = <a class="code" href="systemConfigurations_8h.html#a43b5b35d09b47633d84aa8121c9af2ac">POST_PLL_DIVIDER</a> - 1;
<a name="l00030"></a>00030     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PLLDIV3 = 2; 
<a name="l00031"></a>00031     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PLLDIV5 = 5; 
<a name="l00032"></a>00032     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PLLDIV7 = 5; 
<a name="l00034"></a>00034    <span class="comment">// Moved step 2c and 2d to step 0</span>
<a name="l00035"></a>00035    <span class="comment">/*Set PLLEN=0 and PLLRST=0, Reset the PLL*/</span>
<a name="l00036"></a>00036     <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;=  0xFFFFFFFE;     <span class="comment">/*PLL BYPASS MODE*/</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038    <span class="comment">/*wait for 4 cycles to allow PLLEN mux switches properly to bypass clock*/</span>
<a name="l00039"></a>00039    <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="pllc_8h.html#ac52df1f35d2f80ed8783657ab0a078e2">PLLEN_MUX_SWITCH</a>; i++) {;}   <span class="comment">/*Make PLLEN_MUX_SWITCH as bootpacket*/</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041    <span class="comment">/*Select the Clock Mode bit 8 as External Clock or On Chip Oscilator*/</span>
<a name="l00042"></a>00042     <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;= 0xFFFFFEFF;
<a name="l00043"></a>00043     <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> |= (CLKMODE&lt;&lt;8);  <span class="comment">/* Make CLKSRC as BootPacket to pass the value*/</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045    <span class="comment">/*Set PLLENSRC &#39;0&#39;,bit 5, PLL Enable(PLLEN) selection is controlled through MMR*/</span>
<a name="l00046"></a>00046     <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;=  0xFFFFFFDF;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048    <span class="comment">/*PLLCTL.EXTCLKSRC bit 9 should be left at 0 for Primus*/</span>
<a name="l00049"></a>00049     <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;=  0xFFFFFDFF;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051    <span class="comment">/* Clear PLLRST bit to 0 -Reset the PLL */</span>
<a name="l00052"></a>00052    <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;= 0xFFFFFFF7;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054    <span class="comment">/*Disable the PLL output*/</span>
<a name="l00055"></a>00055    <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> |= 0x10;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057    <span class="comment">/*PLL initialization sequence*/</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059    <span class="comment">/*Power up the PLL- PWRDN bit set to 0 to bring the PLL out of power down bit*/</span>
<a name="l00060"></a>00060    <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;= 0xFFFFFFFD;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062    <span class="comment">/*Enable the PLL from Disable Mode PLLDIS bit to 0 - This is step is not required for Primus*/</span>
<a name="l00063"></a>00063    <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> &amp;= 0xFFFFFFEF;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065    <span class="comment">/*PLL stabilisation time- take out this step , not required here when PLL in bypassmode*/</span>
<a name="l00066"></a>00066   <span class="comment">/* for(i=0; i&lt;PLL_STABILIZATION_TIME; i++) {;}  /* Make PLL_STABILIZATION_TIME as bootpacket*/</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068    <span class="comment">/*Program the required multiplier value in PLLM*/</span>
<a name="l00069"></a>00069    <a class="code" href="pllc_8h.html#a2597c1d061d4674c4b9cacf520b3c824">PLL0_PLLM</a>    = PLLM; <span class="comment">/* Make PLLMULTIPLEIR as bootpacket*/</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071    <span class="comment">/*If desired to scale all the SYSCLK frequencies of a given PLLC, program the POSTDIV ratio*/</span>
<a name="l00072"></a>00072    <a class="code" href="pllc_8h.html#a8b67c8350ac3f201732d25970bd1555d">PLL0_POSTDIV</a> = 0x8000 | POSTDIV; <span class="comment">/* Make POSTDIV as bootpacket*/</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074    <span class="comment">/*If Necessary program the PLLDIVx*/</span>
<a name="l00075"></a>00075    <span class="comment">/*Check for the GOSTAT bit in PLLSTAT to clear to 0 to indicate that no GO operation is currently in progress*/</span>
<a name="l00076"></a>00076    <span class="keywordflow">while</span>(<a class="code" href="pllc_8h.html#a46ea33013fc2404fcba89efd99a382fd">PLL0_PLLSTAT</a> &amp; 0x1==1){}
<a name="l00077"></a>00077 
<a name="l00078"></a>00078    <span class="comment">/*Program the RATIO field in PLLDIVx with the desired divide factors. In addition, make sure in this step you leave the PLLDIVx.DxEN bits set so clocks are still enabled (default).*/</span>
<a name="l00079"></a>00079     <a class="code" href="pllc_8h.html#a0156e5dff81ed6b90929b6007c699a45">PLL0_PLLDIV1</a> = 0x8000 | 0; <span class="comment">/* Make PLLDIV3 as bootpacket, do it for other PLLDIVx to if required*/</span>
<a name="l00080"></a>00080     <a class="code" href="pllc_8h.html#af6b9c9ecc7740e72fb45327298c25808">PLL0_PLLDIV3</a> = 0x8000 | PLLDIV3; <span class="comment">/* Make PLLDIV3 as bootpacket, do it for other PLLDIVx to if required*/</span>
<a name="l00081"></a>00081     <a class="code" href="pllc_8h.html#a63370dc56bab241ac0728fc3ece3c826">PLL0_PLLDIV5</a> = 0x8000 | PLLDIV5; <span class="comment">/* Make PLLDIV5 as bootpacket, do it for other PLLDIVx to if required*/</span>
<a name="l00082"></a>00082     <a class="code" href="pllc_8h.html#acb1399465ba61a3e219971a240dd3a3e">PLL0_PLLDIV7</a> = 0x8000 | PLLDIV7; <span class="comment">/* Make PLLDIV7 as bootpacket, do it for other PLLDIVx to if required*/</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">/*Set the GOSET bit in PLLCMD to 1 to initiate a new divider transition.*/</span>
<a name="l00085"></a>00085     <a class="code" href="pllc_8h.html#af588b23fbe1d84c3fdb55aa32e69c467">PLL0_PLLCMD</a> |= 0x1;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="comment">/*Wait for the GOSTAT bit in PLLSTAT to clear to 0 (completion of phase alignment).*/</span>
<a name="l00088"></a>00088     <span class="keywordflow">while</span>(<a class="code" href="pllc_8h.html#a46ea33013fc2404fcba89efd99a382fd">PLL0_PLLSTAT</a> &amp; 0x1==1) { }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00091"></a>00091    <span class="comment">/*Wait for PLL to reset properly. See PLL spec for PLL reset time - This step is not required here -step11*/</span>
<a name="l00092"></a>00092   <span class="comment">/* for(i=0; i&lt;PLL_RESET_TIME_CNT; i++) {;}   /*128 MXI Cycles*/</span> <span class="comment">/*Make PLL_RESET_TIME_CNT as boot packet*/</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094    <span class="comment">/*Set the PLLRST bit in PLLCTL to 1 to bring the PLL out of reset*/</span>
<a name="l00095"></a>00095    <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> |= 0x8;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097    <span class="comment">/*Wait for PLL to lock. See PLL spec for PLL lock time*/</span>
<a name="l00098"></a>00098    <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="pllc_8h.html#a8b95ff51653f616c5bb49eb18df44dc7">PLL_LOCK_TIME_CNT</a>; i++) {;} <span class="comment">/*Make PLL_LOCK_TIME_CNT as boot Packet*/</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100    <span class="comment">/*Set the PLLEN bit in PLLCTL to 1 to remove the PLL from bypass mode*/</span>
<a name="l00101"></a>00101    <a class="code" href="pllc_8h.html#a5ca0f2b090b4c6b3283d47f6ec8e0b57">PLL0_PLLCTL</a> |=  0x1;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103    <a class="code" href="sysconfig_8h.html#a0db6b71adf28132477e85f81d4efe026">KICK0R</a> = 0x83e70b13;  <span class="comment">// Kick0 register + data (unlock)</span>
<a name="l00104"></a>00104    <a class="code" href="sysconfig_8h.html#ab23852a812e170f77d0a5c292d31753b">KICK1R</a> = 0x95a4f1e0;  <span class="comment">// Kick1 register + data (unlock)</span>
<a name="l00105"></a>00105    <a class="code" href="sysconfig_8h.html#acefa2062fad325b385c7c2b6c5c6ad62">CFGCHIP3</a> |= 0x4;       <span class="comment">// Enable 4.5 divider PLL</span>
<a name="l00106"></a>00106    <a class="code" href="sysconfig_8h.html#acefa2062fad325b385c7c2b6c5c6ad62">CFGCHIP3</a> |= 0x1;       <span class="comment">// Select 4.5 divider for EMIFB clock source only (not EMIFA)</span>
<a name="l00107"></a>00107    <span class="keywordflow">return</span> 1;
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="pllc_8c.html">pllc.c</a>      </li>
      <li class="footer">Generated on Sun May 19 2013 for C6000-evi-lib by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
